<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src='https://unpkg.com/@turf/turf/turf.min.js'></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWKf4vdhuBiiZaJrHs3IVqRUSdwqQPnl4&callback=initMap"></script>
    
    <style>
      body{
          margin:0;
      }

      #map {
          height: 100vh;
          width: 100vw;
      }

      #map img {
          /* height:30px !important; */
          /* width:30px !important; */
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
        var pharmacies = [
            {
                "Name": "Farmácia Aeroporto",
                "google_link": "https://goo.gl/maps/hw2hf5C52wukemKr8",
                "lat": 38.769052,
                "lng": -9.1308041,
                "description": "aeroporto.png"
            },
            {
                "Name": "Farmacia Alegro",
                "google_link": "https://goo.gl/maps/WcuEpxA4UEmuy1pm8",
                "lat": 38.727745,
                "lng": -9.2203583,
                "description": "alegro.png"
            },
            {
                "Name": "Farmácia Central",
                "google_link": "https://goo.gl/maps/Xqrnczo8eM5zKfaHA",
                "lat": 38.8087342,
                "lng": -9.1022272,
                "description": "central.png"
            },
            {
                "Name": "Farmácia Colombo",
                "google_link": "https://goo.gl/maps/4ra3vtoFcuhp2hNB8",
                "lat": 38.7546707,
                "lng": -9.1907003,
                "description": "colombo.png"
            },
            {
                "Name": "Farmácia Cordeiro",
                "google_link": "https://g.page/FarmaciaCordeiroCascais?share",
                "lat": 38.6983221,
                "lng": -9.4216824,
                "description": "cordeiro.png"
            },
            {
                "Name": "Farmácia Fontainhas",
                "google_link": "https://goo.gl/maps/JM1DPjuu9YMxVhRR7",
                "lat": 38.708508,
                "lng": -9.4220042,
                "description": "fontainhas.png"
            },
            {
                "Name": "Farmácia Freitas",
                "google_link": "https://goo.gl/maps/BRHrQfCTuibirayAA",
                "lat": 39.4131396,
                "lng": -9.1391776,
                "description": "freitas.png"
            },
            {
                "Name": "Farmácia Godinho",
                "google_link": "https://goo.gl/maps/Rs1LUT69AGakYQjb9",
                "lat": 38.6926874,
                "lng": -9.3138857,
                "description": "godinho.png"
            },
            {
                "Name": "Farmácia Parque",
                "google_link": "https://g.page/FarmaciaParquedoEstoril?share",
                "lat": 38.704014,
                "lng": -9.397254,
                "description": "parque.png"
            },
            {
                "Name": "Farmácia Salir",
                "google_link": "https://goo.gl/maps/FiHsBptKarvyU3pm6",
                "lat": 39.4298277,
                "lng": -9.0976831,
                "description": "salir.png"
            },
            {
                "Name": "Farmácia Sáo Joáo",
                "google_link": "https://g.page/FarmaciaSaoJoaodoEstoril?share",
                "lat": 38.7019254,
                "lng": -9.3877334,
                "description": "saojoao.png"
            },
            {
                "Name": "Farmácia Veritas",
                "google_link": "https://goo.gl/maps/TE1VC1oULxQFJarYA",
                "lat": 38.7052294,
                "lng": -9.3032895,
                "description": "veritas.png"
            }
        ];
        
        var map;
        var infowindow;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 10,
                center: {lat: 38.7052294, lng: -9.3032895}
            }); 

            var style = {
                strokeWeight: 0.1,
                strokeColor: '#',
                zIndex: 1,
                fillColor: '#ea9500',
                fillOpacity: 0.75,
            };

            // map data styles 
            map.data.setStyle(style);

            var image = {
                url:'pharmacy-icon.png',
                scaledSize: new google.maps.Size(50, 32.5), // scaled size
                origin: new google.maps.Point(0,0), // origin
                anchor: new google.maps.Point(0, 0) // anchor
            }

            for (const pharmacy of pharmacies) {
                // create a new marker
                let marker = new google.maps.Marker({
                    position: {lat: pharmacy.lat, lng: pharmacy.lng},
                    map: map,
                    icon: image,
                });


                // add a event listener
                marker.addListener('click', function() {
                    console.log("Click");
                    clickEventListener(pharmacy);
                });
            }
        
        // map.
        
        function clickEventListener(pharmacy) {
            // create a 20 km circle layer
            var buffer_twenty = turf.buffer(
                turf.point([pharmacy.lng, pharmacy.lat]),
                20
            );

            // create a 10 km circle layer
            var buffer_ten = turf.buffer(
                turf.point([pharmacy.lng, pharmacy.lat]),
                10
            );

            loadBufferToMap(
                turf.featureCollection(
                    [
                        buffer_ten.features[0],
                        buffer_twenty.features[0]
                    ]
                )
            );


            // create a feature collection
            let contentString = "<div class='content'><img src='images/"+pharmacy.description+"'></div>";

            // add an info window

            if(!infowindow) {
                infowindow = new google.maps.InfoWindow({
                    content: contentString,
                    position:{lat: pharmacy.lat, lng: pharmacy.lng},
                });

                
            } else{
                infowindow.setContent(contentString);
                infowindow.setPosition({lat: pharmacy.lat, lng: pharmacy.lng});
            }

            infowindow.open(map);
            
        }

        // add data to the map
        function loadBufferToMap(data) {
            // remove the features
            map.data.addGeoJson()
            // add new features
        }
           
        }
    </script>
  </body>
</html>